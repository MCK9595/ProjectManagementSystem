# プロジェクト管理システム 開発ToDo

本ドキュメントでは、プロジェクト管理システムの開発フローと具体的なタスクを定義します。

## 開発フェーズ概要

1. **環境準備フェーズ** - 開発環境のセットアップ
2. **プロジェクト初期化フェーズ** - .NET Aspireプロジェクトの作成
3. **基盤構築フェーズ** - 共通機能とインフラストラクチャの実装
4. **マイクロサービス実装フェーズ** - 各サービスの実装
5. **フロントエンド実装フェーズ** - Blazor WebAppの実装
6. **統合・テストフェーズ** - 結合テストと品質保証
7. **デプロイメントフェーズ** - 本番環境へのデプロイ準備

## 詳細タスクリスト

### フェーズ1: 環境準備 ⏱️ 想定期間: 1日 ✅ **完了**

#### 1.1 開発環境のセットアップ [高優先度]
- [x] .NET 9 SDK のインストール
- [x] .NET Aspire Workload のインストール
  ```bash
  dotnet workload install aspire
  ```
- [x] Docker Desktop のインストールと設定
- [x] Visual Studio 2022 / VS Code + C# Dev Kit のセットアップ
- [x] Git リポジトリの初期化

### フェーズ2: プロジェクト初期化 ⏱️ 想定期間: 1日 ✅ **完了**

#### 2.1 .NET Aspireプロジェクトの初期化 [高優先度]
- [x] Aspireプロジェクトの作成
  ```bash
  dotnet new aspire -n ProjectManagementSystem
  ```
- [x] ソリューション構造の確認

#### 2.2 各マイクロサービスプロジェクトの作成 [高優先度]
- [x] IdentityService の作成
  ```bash
  dotnet new webapi -n ProjectManagementSystem.IdentityService -o src/Services/IdentityService
  ```
- [x] OrganizationService の作成
- [x] ProjectService の作成
- [x] TaskService の作成
- [x] ApiServiceGateway の作成
- [x] WebApp (Blazor) の作成

#### 2.3 テストプロジェクトの作成 [高優先度]
- [x] 各サービスの単体テストプロジェクト作成
- [x] 結合テストプロジェクトの作成
  ```bash
  dotnet new aspire-xunit -n ProjectManagementSystem.IntegrationTests -o tests/IntegrationTests
  ```

#### 2.4 ソリューションへのプロジェクト追加 [高優先度]
- [x] 全プロジェクトをソリューションに追加
- [x] プロジェクト間の参照設定

### フェーズ3: 基盤構築 ⏱️ 想定期間: 3日 ✅ **完了**

#### 3.1 AppHostプロジェクトの設定 [高優先度]
- [x] Program.cs でのサービス登録
- [x] データベース接続の設定
- [x] サービス間の依存関係定義

#### 3.2 ServiceDefaultsの設定 [高優先度]
- [x] 各サービスへのServiceDefaults参照追加
- [x] 共通ログ設定（ILogger）
- [x] OpenTelemetry設定
- [x] ヘルスチェック設定

#### 3.3 共通ライブラリの作成 [中優先度]
- [x] 共通DTOプロジェクトの作成
- [x] 共通例外クラスの定義
- [x] レスポンスフォーマットの統一化
- [x] ページネーションヘルパーの実装

### フェーズ4: マイクロサービス実装 ⏱️ 想定期間: 3週間

#### 4.1 IdentityService の実装 [高優先度] - 5日 ✅ **完了**
- [x] Entity Framework Core の設定
- [x] User エンティティの実装
- [x] 認証エンドポイントの実装
  - [x] POST /api/v1/auth/login
  - [x] POST /api/v1/auth/logout
  - [x] POST /api/v1/auth/refresh
  - [x] GET /api/v1/auth/me
- [x] JWT トークン生成ロジック
- [x] パスワードハッシュ化
- [x] マイグレーションの作成

#### 4.2 OrganizationService の実装 [中優先度] - 3日 ✅ **完了**
- [x] データモデルの実装（Organization, OrganizationUser）
- [x] CRUD API の実装
- [x] 権限チェックミドルウェア
- [x] マイグレーションの作成

#### 4.3 ProjectService の実装 [中優先度] - 3日 ✅ **完了**
- [x] データモデルの実装（Project, ProjectMember）
- [x] CRUD API の実装
- [x] プロジェクトメンバー管理API
- [x] マイグレーションの作成

#### 4.4 TaskService の実装 [中優先度] - 4日 ✅ **完了**
- [x] データモデルの実装（Task, Comment）
- [x] タスクCRUD API
- [x] コメント機能の実装
- [x] タスク状態管理
- [x] マイグレーションの作成

#### 4.5 ApiServiceGateway の実装 [高優先度] - 2日 ✅ **完了**
- [x] Ocelot パッケージのインストール
- [x] ルーティング設定（ocelot.json）
- [x] 認証ミドルウェアの設定
- [x] レート制限の実装

### フェーズ5: フロントエンド実装 ⏱️ 想定期間: 2週間 ✅ **完了**

#### 5.1 Blazor基本設定 [中優先度] - 2日
- [x] HttpClient の設定
- [x] 認証サービスの実装
- [x] ルーティング設定
- [x] レイアウトコンポーネント

#### 5.2 認証機能 [中優先度] - 2日
- [x] ログインページ
- [x] ユーザー登録ページ（SystemAdmin用）
- [x] 認証状態管理

#### 5.3 組織管理画面 [中優先度] - 2日
- [x] 組織一覧
- [x] 組織作成・編集
- [x] メンバー管理

#### 5.4 プロジェクト管理画面 [中優先度] - 3日
- [x] プロジェクト一覧
- [x] プロジェクト詳細
- [x] メンバー管理

#### 5.5 タスク管理画面 [中優先度] - 3日
- [x] タスク一覧（カンバンビュー）
- [x] タスク詳細・編集
- [x] コメント機能

### フェーズ6: 統合・テスト ⏱️ 想定期間: 1週間

#### 6.1 単体テスト [低優先度] - 70% **完了**
- [x] 各サービスのビジネスロジックテスト（IdentityService完了、他サービス基本テスト実装済み）
- [x] リポジトリ層のテスト（基本的なテストは実装済み）
- [x] コントローラーのテスト（89件のテストが成功）

#### 6.2 結合テスト [低優先度] - 🔧 **修正が必要**
- [x] Aspire.Hosting.Testing を使用した統合テスト（実装済み）
- [x] エンドツーエンドのシナリオテスト（実装済み）
- [x] 認証フローのテスト（実装済み）
- ⚠️ **5件のテストが失敗中（修正が必要）**

#### 6.3 品質保証
- [ ] コードカバレッジの確認（目標: 80%）
- [ ] パフォーマンステスト
- [ ] セキュリティ監査

### フェーズ7: デプロイメント準備 ⏱️ 想定期間: 3日

#### 7.1 CI/CD パイプライン
- [ ] GitHub Actions の設定
- [ ] ビルド・テストの自動化

#### 7.2 本番環境準備
- [ ] 環境変数の設定
- [ ] シークレット管理
- [ ] データベースマイグレーション戦略

## 開発の進め方

### 反復的開発アプローチ

1. **最小限の動作する製品（MVP）を目指す**
   - まず認証機能と基本的なCRUD操作を実装
   - 段階的に機能を追加

2. **垂直スライスでの開発**
   - 1つの機能を全レイヤー（DB → API → UI）で完成させる
   - 例: ユーザー認証機能を最初から最後まで実装

3. **継続的な統合とテスト**
   - 各機能完成時に結合テストを実施
   - Aspire Dashboard で動作確認

### 優先順位の考え方

1. **高優先度**: システムの基盤となる機能
   - 認証・認可
   - APIゲートウェイ
   - 基本的なデータモデル

2. **中優先度**: ビジネスロジックの中核
   - 各エンティティのCRUD操作
   - UI実装

3. **低優先度**: 品質向上に関わる機能
   - テスト実装
   - 監視・ログ機能の拡充

## 注意事項

- 各フェーズ完了時にコードレビューを実施
- データベースマイグレーションは慎重に管理
- セキュリティ要件は常に意識（特に認証・認可）
- ログ出力は ILogger を使用し、構造化ログを心がける

## 次のアクション

1. 開発環境のセットアップを完了する
2. .NET Aspireプロジェクトを初期化する
3. IdentityServiceから実装を開始する